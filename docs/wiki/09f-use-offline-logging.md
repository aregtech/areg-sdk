# Lusan Offline Log Viewer: Post-Mortem Analysis for Areg Applications

This document explains how to use **Lusan** for **offline log analysis**. Offline mode allows developers to load and analyze previously recorded log files without running applications or log collectors.

It is ideal for post-mortem debugging, issue investigation, and log sharing across teams.

## Introduction

Lusan's offline log viewer enables comprehensive analysis of recorded log sessions without requiring running applications or active log collector services. This capability is essential for post-mortem debugging, issue reproduction analysis, collaboration, and investigating complex or intermittent problems that occur in production environments.

**Use Cases:**
- Post-mortem analysis of production incidents
- Debugging rare or intermittent issues
- Sharing debugging sessions with team members
- Performance analysis and optimization
- Compliance and audit trail reviews

---

## Why Use Offline Log Analysis?

Offline analysis provides several advantages over live logging:

**Reproducibility**  
Recorded logs capture the exact sequence of events, enabling:
- Repeated analysis from different perspectives
- Correlation discovery over multiple review sessions
- Validation of fix effectiveness against original issue

**Collaboration**  
Share log files across teams:
- Remote team members can analyze issues independently
- Subject matter experts can review without system access
- Support teams can investigate customer issues safely

**No Runtime Dependencies**  
Analyze logs anywhere:
- No need for running applications
- No `logcollector` service required
- Works offline or in isolated environments
- Reduces system load during analysis

**Historical Analysis**  
Maintain forensic capabilities:
- Compare behavior across different time periods
- Identify regression patterns
- Track performance trends
- Meet compliance and audit requirements

---

## Prerequisites

### Required Components
- **Lusan application** installed from [areg-sdk-tools repository](https://github.com/aregtech/areg-sdk-tools)
- **Recorded log files** in supported format (generated by logcollector, logobserver, or Lusan)

> [!NOTE]
> Unlike live logging, offline analysis requires no network connectivity, running services, or active applications. So that the `./config/lusan.init` file is optional, but it is required if switch to live logging. The dependency of Areg Framework still exists.

---

## Recording Logs for Offline Analysis

Before you can perform offline analysis, logs must be recorded during runtime.

### Recording Methods

#### Method 1: Using `logcollector`

Configure `logcollector` to save logs to files or database, the `./config/areg.init` file should contain such configuration:

```plaintext
log::*::enable                  = true              # Global logging enable / disable flag
log::*::enable::remote          = true              # Remote logging enable / disable flag
log::logcollector::enable::db   = true              # Log Collector service: do not output in the database
log::logcollector::db::engine   = sqlite3           # Log Collector service: The database engine
log::logcollector::db::name     = log_%time%.sqlog  # Log Collector service: The log database name
log::logcollector::db::location = ./logs            # Log Collector service: The log database location
```

**Benefits:**
- Automatic recording of all aggregated logs
- Structured storage in database format
- No application code changes required
- Centralized log collection point

#### Method 2: Using `logobserver`

Record logs using the `logobserver` console tool, the `./config/areg.init` file should contain such configuration:

```plaintext
log::*::enable                  = true              # Global logging enable / disable flag
log::*::enable::remote          = true              # Remote logging enable / disable flag
log::logobserver::enable::db    = true              # Logobserver: do not output in the database
log::logobserver::db::engine    = sqlite3           # Logobserver: The database engine
log::logobserver::db::name      = log_%time%.sqlog  # Logobserver: The log database name
log::logobserver::db::location  = ./logs            # Logobserver: The log database location
```

**Benefits:**
- Selective recording of specific sessions
- Lightweight and flexible
- Command-line scriptable
- Works with existing `logcollector` setup

More details about `logobserver` console application, configuration and command-line options can be found in the [Log Observer Documentation](./04c-logobserver.md).

#### Method 3: Using `Lusan` GUI Application

Record directly from Lusan's live view:
1. Start the `Lusan` application
2. In the menu, select `File` -> `New Live Logs`, or click the `New Live Logs` toolbar button
3. Alternatively, switch to the `Live Logs` tab in the Navigation pane and click `Connect to Log Collector`
4. Lusan automatically connects using settings from `./config/lusan.init`
5. Once connected to the `logcollector`, in the real-time mode it records logs in the `.sqlog` file

<div align="center"><a href="../img/lusan-live-log-connect.png"><img src="../img/lusan-live-log-connect.png" alt="Lusan Live Log to Log Collector" style="width:50%;height:50%"/></a></div>

**Benefits:**
- Visual confirmation of what's being recorded
- Ability to pause and resume recording
- Immediate playback for verification
- Collection of scopes and priorities of interest
- User-friendly interface

**Recorded Log Format**  
The logs are recorded in the `.sqlog` SQLite3 DB format, which can be later analyzed using Lusan's offline log viewer, and as a plain text `.log` file, which can be opened with any text editor.

**Best Practice:** Use SQLite3 DB format for primary storage to analyze later with Lusan's offline log viewer.

---

## Step-by-Step Guide to Offline Log Analysis

### Step 1: Open Recorded Log Files

Launch Lusan and load previously recorded log files. If the `Project Log Directory` of the workspace is configured, the Workspace Navigation pane will display the content of the directory and the saved logs can be opened from the navigation pane. To change the `Project Log Directory`, go to menu `Tools` → `Options` and in opened dialog select `Directories` option:

<div align="center"><a href="../img/lusan-option-workspace-dirs.png"><img src="../img/lusan-option-workspace-dirs.png" alt="Lusan option workspace directories" style="width:60%;height:60%"/></a></div>

Here you can update `Project Log Directory` to see the content in the `Workspace` navigation pane. 

Additionally, the use can select option `Log settings` and in the field `Logs location:` select the path of log file storage directory:

<div align="center"><a href="../img/lusan-option-logcollector.png"><img src="../img/lusan-option-logcollector.png" alt="Lusan Log settings" style="width:60%;height:60%"/></a></div>

The logs can be opened directly from the `Workspace` navigation pane:

<div align="center"><a href="../img/lusan-navigation-logs.png"><img src="../img/lusan-navigation-logs.png" alt="Lusan Log Directory of Workspace Navigation pane" style="width:60%;height:60%"/></a></div>

The log can be as well opened from menu `File` → `Open Offline Logs`, or by pressing `Ctrl + F`.

**Loading Multiple Files:**
Lusan supports loading multiple log files simultaneously:
- Compare logs from different sessions
- Analyze related incidents side-by-side
- View chronological timeline across sessions

---

### Step 2: Navigate the Loaded Log Session

Once loaded, Lusan presents the complete log session with navigation tools.

**Navigation Features:**

**Timeline Scrubber:**
- Visual representation of the entire session duration
- Click or drag to jump to any point in time
- Color-coded sections showing activity intensity

**Scope Tree:**
- Hierarchical view of all instances and scopes in the log
- Show and hide certain priorities of logs on the scopes

---

### Step 3: Apply Filters and Search

Offline analysis provides the similar powerful filtering capabilities as live logging.

**Available Filters:**

#### By Priority Level

Filter by scope priority level via selecting/deselecting priority buttons on the Navigation pane or via the context menu when selecting a scope node and right-clicking on it. This filtering is performed on the database side. It shows or hides the scope logs of the selected priority levels:

<div align="center"><a href="../img/lusan-offline-log-scopes.png"><img src="../img/lusan-offline-log-scopes.png" alt="Lusan Offline Logs and Scope Tree" style="width:60%;height:60%"/></a></div>

The user can select/deselect scope-based priority level to show or hide. The showing and hiding logs is not dependent on priority level. It means that if `DEBUG` level of a scope node is selected, but `WARN` and `INFO` levels are not selected, the `DEBUG` level logs of the scope are shown, `WARN` and`INFO` logs are not shown. This allows to make filtering of particular components, even particular methods.

#### Message-level filtering (viewer side)

Filter by message priority level in the log message window functions in the same like for live logging. This filtering is performed on the Lusan side, and logs of unselected priorities will be hidden from the log viewer.

<div align="center"><a href="../img/lusan-live-log-message-prio.png"><img src="../img/lusan-live-log-message-prio.png" alt="Lusan Live Log Filter Priorities" style="width:80%;height:80%"/></a></div>

Multiple filtering criteria can be selected simultaneously. Filtering by message priority level allows you to filter already received logs without requesting the source application to change the scope priority level. Click the arrow on the column header to apply filters.

**Currently Supported Filtering Criteria:**
- **Filtering by Priority Level** - Show only messages of selected priority levels
- **Filtering by Duration** - Show only messages with duration values greater than or equal to the specified value
- **Filtering by Source** - Show only messages from the specified source name
- **Filtering by Source ID** - Show only messages from the specified source ID
- **Filtering by Thread** - Show only messages from the specified thread name
- **Filtering by Thread ID** - Show only messages from the specified thread ID
- **Filtering by Text Phrase** - Show only messages containing the specified text phrase in log messages (supports wildcards)

#### Filtering in Output Log Analyzes Window

Filtering in output `Log Analyzes` window works in the same way like for live logging. Double-clicking on a message to select logs of the scope and session you want to analyze. This marks messages from the session of the selected scope and displays it in the output Log Analyzer Window at the bottom of the application. Use the following radio buttons to display filtered log messages:

- **Session Logs** - Show only messages of the selected scope session
- **Session Sublogs** - Show only messages of the selected scope session and all its child scopes
- **Scope Logs** - Show only messages of the selected scope, regardless of session
- **Thread Logs** - Show only messages of the selected thread, regardless of scope and session
- **Process Logs** - Show only messages of the selected process, regardless of thread, scope, and session

<div align="center"><a href="../img/lusan-live-log-scope-analyzes.png"><img src="../img/lusan-live-log-scope-analyzes.png" alt="Lusan Live Log Scope Analyzes" style="width:80%;height:80%"/></a></div>

**Filtering Best Practices**

* Start with broad filters
* Narrow down progressively
* Combine multiple filters for precise investigation

---

## Advanced Offline Analysis Features

**Session Comparison:**  
Compare logs from different time periods:
- Before vs. after a deployment
- Good run vs. failed run
- Different configuration scenarios
- Performance baseline vs. degraded state

**Timing Analysis:**  
Measure execution durations:
- Method execution times
- Request processing latency
- Component response times

**Bottleneck Identification:**  
Find performance issues:
- Slowest operations
- Resource wait times
- Network latency spikes

**Advanced Queries:**  
Use query language for complex searches directly in SQLite database:

---

## Use Cases for Offline Analysis

Offline analysis is ideal for:
- Post-mortem debugging
- Root cause analysis
- Reviewing logs from customer environments
- Training and documentation
- Sharing logs with distributed teams

---

## Best Practices for Offline Logging

- Always record logs for complex or intermittent issues
- Store log files with clear timestamps and context
- Share offline logs with the team for collaborative debugging
- Use offline analysis to validate fixes before redeploying

---

## Summary

Lusan's offline log viewer is an indispensable tool for thorough analysis of Areg-based distributed systems and multithreading applications. By enabling detailed examination of recorded sessions without runtime dependencies, it facilitates effective debugging, collaboration, and knowledge building across development teams. It is an essential tool for production diagnostics and long-term maintenance.


**Key Capabilities:**
- ✅ No runtime dependencies required
- ✅ Complete session replay and navigation
- ✅ Powerful filtering and correlation
- ✅ Annotation and documentation features

**Complementary to Live Logging:**
- **Live logging** for active development and immediate feedback
- **Offline analysis** for deep investigation and documentation
